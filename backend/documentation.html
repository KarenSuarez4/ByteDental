<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ByteDental Backend - DocumentaciÃ³n TÃ©cnica</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 60px 20px;
            margin-bottom: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .nav-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .nav-item {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            text-decoration: none;
            color: #5a67d8;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .nav-item:hover {
            background: #5a67d8;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(90, 103, 216, 0.3);
        }

        .section {
            background: white;
            margin-bottom: 30px;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #5a67d8;
            font-size: 2.5em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 3px solid #e2e8f0;
            padding-bottom: 15px;
        }

        .section h3 {
            color: #2d3748;
            font-size: 1.8em;
            margin: 30px 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h4 {
            color: #4a5568;
            font-size: 1.4em;
            margin: 20px 0 10px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .highlight-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.3);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .info-card {
            background: #f7fafc;
            padding: 25px;
            border-radius: 10px;
            border-left: 5px solid #5a67d8;
            transition: all 0.3s ease;
        }

        .info-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .info-card h4 {
            color: #5a67d8;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .features-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .feature-item {
            background: #e6fffa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #38b2ac;
            font-weight: 500;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .metric-number {
            font-size: 2.5em;
            font-weight: bold;
            display: block;
        }

        .metric-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 25px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .architecture-diagram {
            background: #f7fafc;
            padding: 30px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 0.85em;
            line-height: 1.4;
            border: 2px solid #e2e8f0;
            overflow-x: auto;
            margin: 20px 0;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #5a67d8;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f7fafc;
        }

        .tag {
            display: inline-block;
            background: #5a67d8;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            margin: 3px;
        }

        .tag.success { background: #38a169; }
        .tag.warning { background: #d69e2e; }
        .tag.info { background: #3182ce; }
        .tag.danger { background: #e53e3e; }

        footer {
            background: #2d3748;
            color: white;
            text-align: center;
            padding: 40px 20px;
            margin-top: 50px;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            header h1 { font-size: 2em; }
            .section { padding: 20px; }
            .nav-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¦· ByteDental Backend</h1>
            <p>DocumentaciÃ³n TÃ©cnica Completa - API REST con FastAPI</p>
            <p><strong>VersiÃ³n 2.0.0</strong> | Septiembre 2025</p>
        </header>

        <div class="nav-container">
            <h3 style="text-align: center; margin-bottom: 20px; color: #5a67d8;">ğŸ“‹ NavegaciÃ³n RÃ¡pida</h3>
            <div class="nav-grid">
                <a href="#informacion-general" class="nav-item">ğŸ“Š InformaciÃ³n General</a>
                <a href="#arquitectura" class="nav-item">ğŸ—ï¸ Arquitectura</a>
                <a href="#estructura" class="nav-item">ğŸ“ Estructura</a>
                <a href="#tecnologias" class="nav-item">ğŸ› ï¸ TecnologÃ­as</a>
                <a href="#configuracion" class="nav-item">âš™ï¸ ConfiguraciÃ³n</a>
                <a href="#modelos" class="nav-item">ğŸ“Š Modelos BD</a>
                <a href="#autorizacion" class="nav-item">ğŸ›¡ï¸ AutorizaciÃ³n</a>
                <a href="#endpoints" class="nav-item">ğŸ›£ï¸ Endpoints</a>
                <a href="#servicios" class="nav-item">ğŸ”§ Servicios</a>
                <a href="#auditoria" class="nav-item">ğŸ“‹ AuditorÃ­a</a>
                <a href="#instalacion" class="nav-item">ğŸš€ InstalaciÃ³n</a>
                <a href="#despliegue" class="nav-item">ğŸŒ Despliegue</a>
            </div>
        </div>

        <section id="informacion-general" class="section">
            <h2>ğŸ“Š InformaciÃ³n General</h2>
            
            <div class="highlight-box">
                <h3>ğŸ¯ ByteDental Backend</h3>
                <p><strong>API REST desarrollada con FastAPI</strong> que proporciona servicios completos para la gestiÃ³n de usuarios, autenticaciÃ³n, autorizaciÃ³n por roles, auditorÃ­a y comunicaciones por email en un sistema odontolÃ³gico.</p>
            </div>

            <h3>ğŸ¯ CaracterÃ­sticas Principales</h3>
            <div class="features-list">
                <div class="feature-item">âœ… <strong>Sistema de autenticaciÃ³n</strong> con Firebase Authentication</div>
                <div class="feature-item">âœ… <strong>AutorizaciÃ³n por roles</strong> (Administrator, Doctor, Assistant, Auditor)</div>
                <div class="feature-item">âœ… <strong>GestiÃ³n completa de usuarios</strong> con CRUD protegido</div>
                <div class="feature-item">âœ… <strong>AuditorÃ­a integral</strong> de todas las acciones del sistema</div>
                <div class="feature-item">âœ… <strong>Servicio de emails</strong> con plantillas HTML</div>
                <div class="feature-item">âœ… <strong>Sistema OTP</strong> para verificaciÃ³n</div>
                <div class="feature-item">âœ… <strong>Base de datos PostgreSQL</strong> con migraciones</div>
                <div class="feature-item">âœ… <strong>Dockerizado</strong> para desarrollo y producciÃ³n</div>
                <div class="feature-item">âœ… <strong>CORS configurado</strong> para mÃºltiples entornos</div>
            </div>

            <h3>ğŸ“ˆ MÃ©tricas del Proyecto</h3>
            <div class="metrics-grid">
                <div class="metric-card">
                    <span class="metric-number">2.0.0</span>
                    <span class="metric-label">VersiÃ³n</span>
                </div>
                <div class="metric-card">
                    <span class="metric-number">2,500+</span>
                    <span class="metric-label">LÃ­neas de CÃ³digo</span>
                </div>
                <div class="metric-card">
                    <span class="metric-number">25+</span>
                    <span class="metric-label">Endpoints</span>
                </div>
                <div class="metric-card">
                    <span class="metric-number">5</span>
                    <span class="metric-label">Modelos Principales</span>
                </div>
                <div class="metric-card">
                    <span class="metric-number">4</span>
                    <span class="metric-label">Roles de Usuario</span>
                </div>
                <div class="metric-card">
                    <span class="metric-number">100%</span>
                    <span class="metric-label">Endpoints Protegidos</span>
                </div>
            </div>

            <h3>ğŸ¢ TecnologÃ­as Principales</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>ğŸ Backend Framework</h4>
                    <p><strong>FastAPI</strong> - Framework web moderno y rÃ¡pido para Python, con documentaciÃ³n automÃ¡tica y validaciÃ³n de tipos.</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ—„ï¸ Base de Datos</h4>
                    <p><strong>PostgreSQL</strong> - Sistema de gestiÃ³n de base de datos relacional robusto y escalable.</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ” AutenticaciÃ³n</h4>
                    <p><strong>Firebase Authentication</strong> - Servicio de autenticaciÃ³n de Google con JWT tokens.</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ³ Contenedores</h4>
                    <p><strong>Docker</strong> - ContainerizaciÃ³n para desarrollo y despliegue consistente.</p>
                </div>
            </div>
        </section>

        <section id="arquitectura" class="section">
            <h2>ğŸ—ï¸ Arquitectura del Sistema</h2>
            
            <div class="architecture-diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLIENTE (Frontend)                     â”‚
â”‚                   React + Firebase Auth                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ HTTPS/JWT Token
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FASTAPI SERVER                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   MIDDLEWARE    â”‚     ROUTERS     â”‚    SERVICES     â”‚   â”‚
â”‚  â”‚                 â”‚                 â”‚                 â”‚   â”‚
â”‚  â”‚ â€¢ Auth         â”‚ â€¢ Users         â”‚ â€¢ User Service  â”‚   â”‚
â”‚  â”‚ â€¢ CORS         â”‚ â€¢ Auditoria     â”‚ â€¢ Firebase      â”‚   â”‚
â”‚  â”‚ â€¢ Logging      â”‚ â€¢ Email         â”‚ â€¢ Email         â”‚   â”‚
â”‚  â”‚                â”‚ â€¢ OTP           â”‚ â€¢ Auditoria     â”‚   â”‚
â”‚  â”‚                â”‚ â€¢ Auth          â”‚ â€¢ OTP           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ SQL Queries
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   POSTGRESQL DATABASE                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   users     â”‚    roles     â”‚ audit_logs â”‚   otp_codes  â”‚ â”‚
â”‚  â”‚   emails    â”‚              â”‚            â”‚              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                SERVICIOS EXTERNOS                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Firebase Auth  â”‚   Gmail SMTP    â”‚   Render Cloud  â”‚   â”‚
â”‚  â”‚                 â”‚                 â”‚                 â”‚   â”‚
â”‚  â”‚ â€¢ AutenticaciÃ³n â”‚ â€¢ EnvÃ­o emails  â”‚ â€¢ Hosting       â”‚   â”‚
â”‚  â”‚ â€¢ JWT Tokens    â”‚ â€¢ Plantillas    â”‚ â€¢ Base de datos â”‚   â”‚
â”‚  â”‚ â€¢ GestiÃ³n users â”‚ â€¢ OTP codes     â”‚ â€¢ SSL/TLS       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </div>

            <h3>ğŸ”„ Flujo de AutenticaciÃ³n y AutorizaciÃ³n</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>1ï¸âƒ£ AutenticaciÃ³n</h4>
                    <p>Usuario â†’ Login en Frontend â†’ Firebase Auth â†’ Genera JWT Token</p>
                </div>
                <div class="info-card">
                    <h4>2ï¸âƒ£ Request</h4>
                    <p>Frontend â†’ EnvÃ­a requests con Bearer Token â†’ FastAPI Middleware</p>
                </div>
                <div class="info-card">
                    <h4>3ï¸âƒ£ ValidaciÃ³n</h4>
                    <p>Middleware â†’ Valida JWT con Firebase â†’ Database â†’ Verifica rol</p>
                </div>
                <div class="info-card">
                    <h4>4ï¸âƒ£ EjecuciÃ³n</h4>
                    <p>Endpoint â†’ Ejecuta segÃºn permisos â†’ AuditorÃ­a â†’ Response</p>
                </div>
            </div>
        </section>

        <section id="estructura" class="section">
            <h2>ğŸ“ Estructura del Proyecto</h2>
            
            <div class="code-block">
backend/
â”œâ”€â”€ ğŸ”§ ConfiguraciÃ³n
â”‚   â”œâ”€â”€ .env                           # Variables de entorno
â”‚   â”œâ”€â”€ .gitignore                     # Archivos ignorados por Git
â”‚   â”œâ”€â”€ requirements.txt               # Dependencias Python
â”‚   â”œâ”€â”€ alembic.ini                   # ConfiguraciÃ³n migraciones
â”‚   â”œâ”€â”€ docker-compose.yml            # Docker para BD
â”‚   â””â”€â”€ main.py                       # AplicaciÃ³n principal FastAPI
â”‚
â”œâ”€â”€ ğŸ—ï¸ AplicaciÃ³n Principal
â”‚   â””â”€â”€ app/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ config.py                 # ConfiguraciÃ³n centralizada
â”‚       â”œâ”€â”€ database.py               # ConexiÃ³n a PostgreSQL
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ›¡ï¸ middleware/
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â””â”€â”€ auth_middleware.py    # AutorizaciÃ³n por roles
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“Š models/
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ user_models.py        # Modelo de usuarios
â”‚       â”‚   â”œâ”€â”€ rol_models.py         # Modelo de roles
â”‚       â”‚   â”œâ”€â”€ auditoria_models.py   # Modelo de auditorÃ­a
â”‚       â”‚   â”œâ”€â”€ email_models.py       # Modelo de emails
â”‚       â”‚   â””â”€â”€ otp_models.py         # Modelo de cÃ³digos OTP
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ›£ï¸ routers/
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ users.py              # CRUD usuarios (Admin only)
â”‚       â”‚   â”œâ”€â”€ auditoria.py          # Logs auditorÃ­a (Auditor only)
â”‚       â”‚   â”œâ”€â”€ auth.py               # AutenticaciÃ³n
â”‚       â”‚   â”œâ”€â”€ email_router.py       # GestiÃ³n de emails
â”‚       â”‚   â””â”€â”€ otp_router.py         # GestiÃ³n de OTP
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ”§ services/
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ user_service.py       # LÃ³gica de negocio usuarios
â”‚       â”‚   â”œâ”€â”€ firebase_service.py   # IntegraciÃ³n Firebase
â”‚       â”‚   â”œâ”€â”€ auditoria_service.py  # LÃ³gica de auditorÃ­a
â”‚       â”‚   â”œâ”€â”€ email_service.py      # Servicio de emails
â”‚       â”‚   â””â”€â”€ otp_service.py        # Servicio de cÃ³digos OTP
â”‚       â”‚
â”‚       â””â”€â”€ ğŸ“§ templates/
â”‚           â”œâ”€â”€ general_email.html    # Plantilla email general
â”‚           â””â”€â”€ otp_email.html        # Plantilla email OTP
â”‚
â”œâ”€â”€ ğŸ—„ï¸ Base de Datos
â”‚   â””â”€â”€ init-scripts/
â”‚       â””â”€â”€ 01-init.sql              # Script inicial de BD
â”‚
â”œâ”€â”€ ğŸ”§ Scripts
â”‚   â””â”€â”€ scripts/
â”‚       â””â”€â”€ insert_roles.py          # InserciÃ³n de roles iniciales
â”‚
â””â”€â”€ ğŸ” Credenciales
    â””â”€â”€ bytedental-***-firebase-adminsdk-***.json  # Credenciales Firebase
            </div>

            <h3>ğŸ“‹ DescripciÃ³n de Componentes</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>ğŸ›¡ï¸ Middleware</h4>
                    <p>GestiÃ³n de autenticaciÃ³n, autorizaciÃ³n por roles, CORS y logging de requests.</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ“Š Models</h4>
                    <p>DefiniciÃ³n de esquemas de base de datos usando SQLAlchemy ORM.</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ›£ï¸ Routers</h4>
                    <p>Endpoints de la API organizados por funcionalidad con protecciÃ³n por roles.</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ”§ Services</h4>
                    <p>LÃ³gica de negocio separada de los endpoints para mejor organizaciÃ³n.</p>
                </div>
            </div>
        </section>

        <section id="tecnologias" class="section">
            <h2>ğŸ› ï¸ TecnologÃ­as y Dependencias</h2>
            
            <h3>ğŸ Framework Principal</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>FastAPI</h4>
                    <p>Framework web moderno y rÃ¡pido para Python con documentaciÃ³n automÃ¡tica</p>
                    <span class="tag">Python</span><span class="tag">Web Framework</span>
                </div>
                <div class="info-card">
                    <h4>Uvicorn</h4>
                    <p>Servidor ASGI lightning-fast para aplicaciones FastAPI</p>
                    <span class="tag">ASGI</span><span class="tag">Server</span>
                </div>
                <div class="info-card">
                    <h4>Pydantic</h4>
                    <p>ValidaciÃ³n de datos y configuraciÃ³n usando type hints de Python</p>
                    <span class="tag">Validation</span><span class="tag">Settings</span>
                </div>
            </div>

            <h3>ğŸ—„ï¸ Base de Datos</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>PostgreSQL</h4>
                    <p>Sistema de gestiÃ³n de base de datos relacional robusta</p>
                    <span class="tag success">Relational</span><span class="tag">SQL</span>
                </div>
                <div class="info-card">
                    <h4>SQLAlchemy</h4>
                    <p>ORM (Object-Relational Mapping) mÃ¡s popular para Python</p>
                    <span class="tag">ORM</span><span class="tag">Database</span>
                </div>
                <div class="info-card">
                    <h4>Alembic</h4>
                    <p>Herramienta de migraciÃ³n de base de datos para SQLAlchemy</p>
                    <span class="tag">Migrations</span><span class="tag">Versioning</span>
                </div>
            </div>

            <h3>ğŸ” AutenticaciÃ³n y Seguridad</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>Firebase Admin SDK</h4>
                    <p>AutenticaciÃ³n y gestiÃ³n de usuarios con Google Firebase</p>
                    <span class="tag warning">Firebase</span><span class="tag">JWT</span>
                </div>
                <div class="info-card">
                    <h4>python-jose</h4>
                    <p>ImplementaciÃ³n de JSON Web Tokens (JWT) para Python</p>
                    <span class="tag">JWT</span><span class="tag">Crypto</span>
                </div>
                <div class="info-card">
                    <h4>passlib</h4>
                    <p>Biblioteca de hashing de contraseÃ±as con soporte bcrypt</p>
                    <span class="tag">Password</span><span class="tag">Bcrypt</span>
                </div>
            </div>

            <h3>ğŸ“¦ Dependencias Completas</h3>
            <div class="code-block">
fastapi==0.104.1
uvicorn[standard]==0.24.0
python-multipart==0.0.6
pydantic==2.5.0
pydantic-settings==2.1.0
python-dotenv==1.0.0
jinja2==3.1.2
aiofiles==23.2.1
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
email-validator==2.1.0
sqlalchemy==2.0.23
psycopg2-binary==2.9.9
alembic==1.13.0
firebase-admin==6.2.0
            </div>
        </section>

        <section id="configuracion" class="section">
            <h2>âš™ï¸ ConfiguraciÃ³n</h2>
            
            <h3>ğŸ“ Variables de Entorno (.env)</h3>
            <div class="code-block">
# ğŸ¢ ConfiguraciÃ³n de la AplicaciÃ³n
APP_NAME=ByteDental Backend API
FROM_EMAIL=bytedental@company.com
FROM_NAME=ByteDental Team
FRONTEND_URL=http://localhost:5173

# ğŸ—„ï¸ Base de Datos PostgreSQL
DATABASE_URL=postgresql://username:password@localhost:5432/bytedental_db
DB_HOST=localhost
DB_PORT=5432
DB_NAME=bytedental_db
DB_USER=username
DB_PASSWORD=password

# ğŸ“§ ConfiguraciÃ³n SMTP (Gmail)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=tu-email@gmail.com
SMTP_PASSWORD=tu-app-password
SMTP_TLS=True
SMTP_SSL=False

# ğŸ”¥ Firebase
FIREBASE_CREDENTIALS_PATH=bytedental-***-firebase-adminsdk-***.json
            </div>

            <h3>ğŸ”§ ConfiguraciÃ³n Centralizada</h3>
            <p>La aplicaciÃ³n utiliza <strong>Pydantic Settings</strong> para gestiÃ³n centralizada de configuraciÃ³n:</p>
            
            <div class="info-grid">
                <div class="info-card">
                    <h4>ğŸ—ï¸ ConfiguraciÃ³n AutomÃ¡tica</h4>
                    <p>Carga automÃ¡tica de variables desde archivo .env con valores por defecto</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ” ValidaciÃ³n de Tipos</h4>
                    <p>ValidaciÃ³n automÃ¡tica de tipos de datos usando Pydantic</p>
                </div>
                <div class="info-card">
                    <h4>ğŸŒ Multi-entorno</h4>
                    <p>Soporte para desarrollo, staging y producciÃ³n</p>
                </div>
                <div class="info-card">
                    <h4>ğŸ” Seguridad</h4>
                    <p>Variables sensibles separadas del cÃ³digo fuente</p>
                </div>
            </div>

            <div class="code-block">
class Settings(BaseSettings):
    # SMTP Configuration
    smtp_host: str = "smtp.gmail.com"
    smtp_port: int = 587
    smtp_username: str = ""
    smtp_password: str = ""
    
    # Application Configuration  
    app_name: str = "ByteDental Email Service"
    from_email: str = ""
    frontend_url: str = "http://localhost:5173"
    
    # Database Configuration
    database_url: str = "postgresql://username:password@localhost:5432/bytedental_db"
    
    # Firebase
    firebase_credentials_path: str = "firebase-credentials.json"
            </div>
        </section>

        <section id="modelos" class="section">
            <h2>ğŸ“Š Modelos de Base de Datos</h2>
            
            <h3>ğŸ‘¤ User Model (users)</h3>
            <div class="code-block">
class User(Base):
    __tablename__ = "users"
    
    uid = Column(String(128), primary_key=True)          # Firebase UID
    document_number = Column(String(20), nullable=False)  # NÃºmero documento
    document_type = Column(Enum('CC', 'TI', 'CE', 'PP'))# Tipo documento
    first_name = Column(String(100), nullable=False)     # Nombres
    last_name = Column(String(100), nullable=False)      # Apellidos
    email = Column(String(255), unique=True)             # Email Ãºnico
    phone = Column(String(20), nullable=True)            # TelÃ©fono
    role_id = Column(Integer, ForeignKey("roles.id"))    # Rol asignado
    specialty = Column(String(100), nullable=True)       # Especialidad
    is_active = Column(Boolean, default=True)            # Estado activo
    created_at = Column(TIMESTAMP, server_default=func.now())
    updated_at = Column(TIMESTAMP, onupdate=func.now())
            </div>

            <h3>ğŸ­ Role Model (roles)</h3>
            <div class="code-block">
class Role(Base):
    __tablename__ = "roles"
    
    id = Column(Integer, primary_key=True)
    name = Column(String(50), unique=True)        # Administrator, Doctor, etc.
    description = Column(Text)                    # DescripciÃ³n del rol
    is_active = Column(Boolean, default=True)     # Estado del rol
    created_at = Column(TIMESTAMP, server_default=func.now())
    updated_at = Column(TIMESTAMP, onupdate=func.now())
            </div>

            <h3>ğŸ“‹ Audit Log Model (audit_logs)</h3>
            <div class="code-block">
class AuditLog(Base):
    __tablename__ = "audit_logs"
    
    id = Column(Integer, primary_key=True)
    event_type = Column(String(50))               # CREATE, UPDATE, DELETE, etc.
    user_id = Column(String(128))                 # UID del usuario que ejecuta
    affected_table = Column(String(50))           # Tabla afectada
    record_id = Column(String(128))               # ID del registro afectado
    old_values = Column(JSON)                     # Valores anteriores
    new_values = Column(JSON)                     # Valores nuevos
    ip_address = Column(String(45))               # IP del cliente
    user_agent = Column(Text)                     # Navegador/cliente
    details = Column(Text)                        # Detalles adicionales
    created_at = Column(TIMESTAMP, server_default=func.now())
            </div>

            <h3>ğŸ“§ Email Model (emails)</h3>
            <div class="code-block">
class Email(Base):
    __tablename__ = "emails"
    
    id = Column(Integer, primary_key=True)
    from_email = Column(String(255))              # Email origen
    to_email = Column(String(255))                # Email destino
    subject = Column(String(255))                 # Asunto
    body = Column(Text)                           # Cuerpo del email
    email_type = Column(String(50))               # GENERAL, OTP, etc.
    status = Column(String(20))                   # SENT, FAILED, PENDING
    sent_at = Column(TIMESTAMP)                   # Fecha de envÃ­o
    created_at = Column(TIMESTAMP, server_default=func.now())
            </div>

            <h3>ğŸ”¢ OTP Model (otp_codes)</h3>
            <div class="code-block">
class OTPCode(Base):
    __tablename__ = "otp_codes"
    
    id = Column(Integer, primary_key=True)
    email = Column(String(255))                   # Email del destinatario
    code = Column(String(6))                      # CÃ³digo de 6 dÃ­gitos
    purpose = Column(String(50))                  # PASSWORD_RESET, VERIFICATION
    is_used = Column(Boolean, default=False)      # Si ya fue usado
    expires_at = Column(TIMESTAMP)                # Fecha de expiraciÃ³n
    created_at = Column(TIMESTAMP, server_default=func.now())
            </div>

            <h3>ğŸ—‚ï¸ Relaciones Entre Modelos</h3>
            <div class="architecture-diagram">
Users â”€â”€â”
        â”œâ”€â”€ Role (Many-to-One)
        â””â”€â”€ AuditLogs (One-to-Many via user_id)

Emails â”€â”€â”€â”€ Users (via email field)
OTPCodes â”€â”€ Users (via email field)
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Tabla</th>
                            <th>Campos Principales</th>
                            <th>Relaciones</th>
                            <th>PropÃ³sito</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>users</strong></td>
                            <td>uid, email, first_name, last_name, role_id</td>
                            <td>Many-to-One con roles</td>
                            <td>GestiÃ³n de usuarios del sistema</td>
                        </tr>
                        <tr>
                            <td><strong>roles</strong></td>
                            <td>id, name, description</td>
                            <td>One-to-Many con users</td>
                            <td>DefiniciÃ³n de roles y permisos</td>
                        </tr>
                        <tr>
                            <td><strong>audit_logs</strong></td>
                            <td>event_type, user_id, old_values, new_values</td>
                            <td>Referencia users via user_id</td>
                            <td>Trazabilidad de todas las acciones</td>
                        </tr>
                        <tr>
                            <td><strong>emails</strong></td>
                            <td>from_email, to_email, subject, status</td>
                            <td>Referencia users via email</td>
                            <td>Historial de comunicaciones</td>
                        </tr>
                        <tr>
                            <td><strong>otp_codes</strong></td>
                            <td>email, code, purpose, expires_at</td>
                            <td>Referencia users via email</td>
                            <td>CÃ³digos de verificaciÃ³n temporales</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section id="autorizacion" class="section">
            <h2>ğŸ›¡ï¸ Sistema de AutorizaciÃ³n</h2>
            
            <h3>ğŸ­ Roles del Sistema</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Rol</th>
                            <th>DescripciÃ³n</th>
                            <th>Permisos Principales</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="tag danger">ğŸ‘‘ Administrator</span></td>
                            <td>Administrador del sistema</td>
                            <td>â€¢ CRUD completo de usuarios<br>â€¢ GestiÃ³n de roles<br>â€¢ ConfiguraciÃ³n del sistema</td>
                        </tr>
                        <tr>
                            <td><span class="tag info">ğŸ” Auditor</span></td>
                            <td>Auditor del sistema</td>
                            <td>â€¢ Solo lectura de logs de auditorÃ­a<br>â€¢ Consulta de actividades<br>â€¢ GeneraciÃ³n de reportes</td>
                        </tr>
                        <tr>
                            <td><span class="tag success">ğŸ‘¨â€âš•ï¸ Doctor</span></td>
                            <td>Profesional mÃ©dico</td>
                            <td>â€¢ Acceso al dashboard<br>â€¢ GestiÃ³n de pacientes<br>â€¢ Consulta de informaciÃ³n</td>
                        </tr>
                        <tr>
                            <td><span class="tag warning">ğŸ‘©â€ğŸ’¼ Assistant</span></td>
                            <td>Asistente dental</td>
                            <td>â€¢ Acceso limitado al dashboard<br>â€¢ Tareas administrativas bÃ¡sicas</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>ğŸ” Middleware de AutorizaciÃ³n</h3>
            <div class="code-block">
# Funciones de autorizaciÃ³n disponibles:
get_current_user()           # Usuario autenticado bÃ¡sico
get_current_admin_user()     # Solo Administrators
get_current_auditor_user()   # Solo Auditors

# Ejemplo de endpoint protegido
@router.get("/users", dependencies=[Depends(get_current_admin_user)])
async def list_users():
    # Solo accesible para Administrators
    pass

@router.get("/auditoria", dependencies=[Depends(get_current_auditor_user)])  
async def get_audit_logs():
    # Solo accesible para Auditors
    pass
            </div>

            <h3>ğŸ¯ Matriz de Permisos</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Funcionalidad</th>
                            <th>ğŸ‘‘ Administrator</th>
                            <th>ğŸ” Auditor</th>
                            <th>ğŸ‘¨â€âš•ï¸ Doctor</th>
                            <th>ğŸ‘©â€ğŸ’¼ Assistant</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>GestiÃ³n de Usuarios</strong></td>
                            <td><span class="tag success">âœ… CRUD Completo</span></td>
                            <td><span class="tag danger">âŒ Sin Acceso</span></td>
                            <td><span class="tag danger">âŒ Sin Acceso</span></td>
                            <td><span class="tag danger">âŒ Sin Acceso</span></td>
                        </tr>
                        <tr>
                            <td><strong>Logs de AuditorÃ­a</strong></td>
                            <td><span class="tag danger">âŒ Sin Acceso</span></td>
                            <td><span class="tag success">âœ… Solo Lectura</span></td>
                            <td><span class="tag danger">âŒ Sin Acceso</span></td>
                            <td><span class="tag danger">âŒ Sin Acceso</span></td>
                        </tr>
                        <tr>
                            <td><strong>Dashboard</strong></td>
                            <td><span class="tag success">âœ… Acceso</span></td>
                            <td><span class="tag success">âœ… Acceso</span></td>
                            <td><span class="tag success">âœ… Acceso</span></td>
                            <td><span class="tag success">âœ… Acceso</span></td>
                        </tr>
                        <tr>
                            <td><strong>GestiÃ³n de Emails</strong></td>
                            <td><span class="tag success">âœ… Completo</span></td>
                            <td><span class="tag warning">âš ï¸ Limitado</span></td>
                            <td><span class="tag warning">âš ï¸ Limitado</span></td>
                            <td><span class="tag warning">âš ï¸ Limitado</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>ğŸ” Flujo de AutorizaciÃ³n</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>1ï¸âƒ£ Request con JWT</h4>
                    <p>Cliente envÃ­a request con token Bearer en headers</p>
                </div>
                <div class="info-card">
                    <h4>2ï¸âƒ£ ValidaciÃ³n Firebase</h4>
                    <p>Middleware valida token JWT con Firebase Admin SDK</p>
                </div>
                <div class="info-card">
                    <h4>3ï¸âƒ£ VerificaciÃ³n Usuario</h4>
                    <p>Busca usuario en BD y verifica estado activo</p>
                </div>
                <div class="info-card">
                    <h4>4ï¸âƒ£ AutorizaciÃ³n Rol</h4>
                    <p>Verifica que el rol tenga permisos para el endpoint</p>
                </div>
                <div class="info-card">
                    <h4>5ï¸âƒ£ EjecuciÃ³n</h4>
                    <p>Procesa request y registra acciÃ³n en auditorÃ­a</p>
                </div>
                <div class="info-card">
                    <h4>6ï¸âƒ£ Response</h4>
                    <p>Retorna resultado al cliente con logging completo</p>
                </div>
            </div>
        </section>

        <section id="instalacion" class="section">
            <h2>ğŸš€ GuÃ­a de InstalaciÃ³n</h2>
            
            <h3>ğŸ“‹ Prerrequisitos</h3>
            <div class="features-list">
                <div class="feature-item">ğŸ <strong>Python 3.8+</strong> instalado</div>
                <div class="feature-item">ğŸ—„ï¸ <strong>PostgreSQL 12+</strong> configurado</div>
                <div class="feature-item">ğŸ”¥ <strong>Firebase Project</strong> creado</div>
                <div class="feature-item">ğŸ“§ <strong>Gmail Account</strong> con App Password</div>
            </div>

            <h3>ğŸ”§ Pasos de InstalaciÃ³n</h3>
            
            <h4>1ï¸âƒ£ Clonar y configurar entorno</h4>
            <div class="code-block">
git clone &lt;repository&gt;
cd backend
python -m venv venv
venv\Scripts\activate  # Windows
# source venv/bin/activate  # Linux/Mac
            </div>

            <h4>2ï¸âƒ£ Instalar dependencias</h4>
            <div class="code-block">
pip install -r requirements.txt
            </div>

            <h4>3ï¸âƒ£ Configurar variables de entorno</h4>
            <div class="code-block">
# Crear archivo .env con la configuraciÃ³n necesaria
cp .env.example .env
# Editar .env con tus valores
            </div>

            <h4>4ï¸âƒ£ Configurar Base de Datos</h4>
            <div class="code-block">
# Usando Docker (recomendado)
docker-compose up -d

# O manual PostgreSQL
createdb bytedental_db
            </div>

            <h4>5ï¸âƒ£ Ejecutar migraciones</h4>
            <div class="code-block">
alembic upgrade head
            </div>

            <h4>6ï¸âƒ£ Insertar roles iniciales</h4>
            <div class="code-block">
python scripts/insert_roles.py
            </div>

            <h4>7ï¸âƒ£ Iniciar servidor</h4>
            <div class="code-block">
# Desarrollo
uvicorn main:app --reload --host 0.0.0.0 --port 8000

# ProducciÃ³n
uvicorn main:app --host 0.0.0.0 --port 8000
            </div>

            <div class="highlight-box">
                <h3>ğŸ‰ Â¡Listo!</h3>
                <p>Tu servidor ByteDental Backend estÃ¡ ejecutÃ¡ndose en:</p>
                <p><strong>ğŸŒ API: http://localhost:8000</strong></p>
                <p><strong>ğŸ“š Docs: http://localhost:8000/docs</strong></p>
                <p><strong>ğŸ¥ Health: http://localhost:8000/health</strong></p>
            </div>
        </section>

        <footer>
            <h2>ğŸ¦· ByteDental Backend</h2>
            <p><strong>DocumentaciÃ³n TÃ©cnica Completa</strong></p>
            <p>API REST con FastAPI - VersiÃ³n 2.0.0</p>
            <p>Sistema de gestiÃ³n odontolÃ³gica con autorizaciÃ³n por roles</p>
            <br>
            <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                <span class="tag">FastAPI</span>
                <span class="tag">PostgreSQL</span>
                <span class="tag">Firebase Auth</span>
                <span class="tag">Docker</span>
                <span class="tag">Python</span>
            </div>
            <br>
            <p><em>Ãšltima actualizaciÃ³n: Septiembre 11, 2025</em></p>
        </footer>

    </div>

    <script>
        // Smooth scrolling para navegaciÃ³n
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Highlight del menÃº de navegaciÃ³n
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('.section');
            const navItems = document.querySelectorAll('.nav-item');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (pageYOffset >= sectionTop - 200) {
                    current = section.getAttribute('id');
                }
            });

            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href') === '#' + current) {
                    item.classList.add('active');
                }
            });
        });
    </script>

    <style>
        .nav-item.active {
            background: #5a67d8 !important;
            color: white !important;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(90, 103, 216, 0.3);
        }
    </style>

</body>
</html>
